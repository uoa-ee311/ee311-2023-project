Version 4
SHEET 1 2708 1540
WIRE 2096 32 2096 0
WIRE 192 48 112 48
WIRE 256 48 192 48
WIRE 416 48 256 48
WIRE 640 48 544 48
WIRE 800 48 704 48
WIRE 896 48 800 48
WIRE 928 48 896 48
WIRE 1152 48 928 48
WIRE 416 64 416 48
WIRE 544 64 544 48
WIRE 256 80 256 48
WIRE 1952 80 1904 80
WIRE 800 112 800 48
WIRE 928 112 928 48
WIRE 2304 112 2240 112
WIRE 2352 112 2304 112
WIRE 1152 144 1152 128
WIRE 1264 144 1152 144
WIRE 1648 144 1600 144
WIRE 1776 144 1728 144
WIRE 1952 144 1776 144
WIRE 2352 144 2352 112
WIRE 1152 160 1152 144
WIRE 256 192 256 144
WIRE 288 192 256 192
WIRE 416 192 416 144
WIRE 416 192 368 192
WIRE 1952 208 1872 208
WIRE 112 224 112 48
WIRE 2352 240 2352 224
WIRE 2352 240 2240 240
WIRE 544 256 544 144
WIRE 720 256 544 256
WIRE 800 256 800 176
WIRE 800 256 720 256
WIRE 928 256 928 192
WIRE 928 256 800 256
WIRE 1152 256 1152 240
WIRE 720 272 720 256
WIRE 1952 272 1920 272
WIRE 2352 272 2352 240
WIRE 416 288 416 192
WIRE 1872 320 1872 288
WIRE 1920 320 1920 272
WIRE 1920 320 1872 320
WIRE 1872 336 1872 320
WIRE 2096 352 2096 320
WIRE 288 368 272 368
WIRE 1408 368 1312 368
WIRE 1504 368 1408 368
WIRE 1568 368 1504 368
WIRE 2352 368 2352 336
WIRE 416 416 416 384
WIRE 512 416 416 416
WIRE 1312 416 1312 368
WIRE 1408 416 1408 368
WIRE 416 432 416 416
WIRE 1568 480 1568 368
WIRE 112 512 112 304
WIRE 224 512 112 512
WIRE 416 512 224 512
WIRE 1312 512 1312 480
WIRE 1408 512 1408 496
WIRE 1408 512 1312 512
WIRE 224 528 224 512
WIRE 1408 528 1408 512
WIRE 1504 528 1408 528
WIRE 1872 560 1872 416
WIRE 1888 560 1872 560
WIRE 2096 560 1968 560
WIRE 2176 560 2096 560
WIRE 2320 560 2272 560
WIRE 2368 560 2320 560
WIRE 2512 560 2448 560
WIRE 1408 592 1408 528
WIRE 1568 640 1568 576
WIRE 1584 640 1568 640
WIRE 1728 640 1664 640
WIRE 1840 640 1728 640
WIRE 1936 640 1936 592
WIRE 1936 640 1840 640
WIRE 2416 656 2416 592
WIRE 2464 656 2416 656
WIRE 2528 656 2464 656
WIRE 1728 672 1728 640
WIRE 2528 688 2528 656
WIRE 1408 720 1408 672
WIRE 1408 848 1408 784
WIRE 1536 848 1408 848
WIRE 1728 848 1728 736
WIRE 1728 848 1536 848
WIRE 1536 864 1536 848
FLAG 224 528 0
FLAG 720 272 0
FLAG 272 368 Vg
FLAG 2528 768 0
FLAG 192 48 Vin
FLAG 2096 0 Vin
FLAG 2096 352 0
FLAG 1904 80 Vg
FLAG 1776 208 0
FLAG 2352 368 0
FLAG 512 416 Is_fb
FLAG 1600 144 Is_fb
FLAG 2304 112 5V
FLAG 896 48 Vout
FLAG 1152 256 0
FLAG 1264 144 Vo_fb
FLAG 2512 560 Vo_fb
FLAG 2464 656 Vref
FLAG 2096 560 PI_out
FLAG 2320 560 Verr
FLAG 1504 368 Vout
FLAG 1536 864 0
FLAG 1840 640 Protection
SYMBOL PID 2224 560 M0
WINDOW 39 14 70 Center 2
WINDOW 123 11 39 Center 2
SYMATTR SpiceLine Kp=xx Ki=xx Kd=0
SYMATTR Value2 min=0.1 max=4.9 Klim=400
SYMATTR InstName U1
SYMATTR SpiceLine2 Ts=0.01m method=0
SYMBOL voltage 112 208 R0
SYMATTR InstName Vin
SYMATTR Value 20
SYMBOL ind2 400 48 R0
WINDOW 0 36 81 Left 2
WINDOW 3 34 107 Left 2
SYMATTR InstName Lp
SYMATTR Value xx
SYMATTR Type ind
SYMATTR SpiceLine Rser=0.01
SYMBOL ind2 560 160 R180
WINDOW 0 36 80 Left 2
WINDOW 3 33 105 Left 2
SYMATTR InstName Ls
SYMATTR Value xx
SYMATTR Type ind
SYMATTR SpiceLine Rser=0.01
SYMBOL nmos 368 288 R0
SYMATTR InstName Sp
SYMATTR Value BSC100N06LS3
SYMBOL diode 640 64 R270
WINDOW 0 32 32 VTop 2
WINDOW 3 0 32 VBottom 2
SYMATTR InstName Ds
SYMBOL cap 784 112 R0
SYMATTR InstName Co
SYMATTR Value xx
SYMATTR SpiceLine Rser=10m
SYMBOL res 912 96 R0
SYMATTR InstName Rload
SYMATTR Value xx
SYMBOL res 400 416 R0
SYMATTR InstName Rs
SYMATTR Value xx
SYMBOL res 384 352 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rg
SYMATTR Value xx
SYMBOL voltage 2528 672 M0
WINDOW 3 97 47 Right 2
WINDOW 123 0 0 Left 0
WINDOW 39 0 0 Left 0
WINDOW 0 43 19 Left 2
SYMATTR Value 0.7
SYMATTR InstName Vref
SYMBOL PowerProducts/LT1247 2096 176 M0
SYMATTR InstName U2
SYMBOL cap 1792 144 M0
WINDOW 0 40 28 Left 2
WINDOW 3 38 54 Left 2
SYMATTR InstName Cif
SYMATTR Value xx
SYMBOL res 1632 128 M90
WINDOW 0 0 56 VBottom 2
WINDOW 3 -54 52 VTop 2
SYMATTR InstName Rif
SYMATTR Value xx
SYMBOL res 2368 128 M0
SYMATTR InstName Rt
SYMATTR Value xx
SYMBOL cap 2368 272 M0
SYMATTR InstName Ct
SYMATTR Value xx
SYMBOL Math2r 2416 560 M0
SYMATTR InstName U3
SYMBOL res 1136 32 R0
SYMATTR InstName Rva
SYMATTR Value xx
SYMBOL res 1136 144 R0
SYMATTR InstName Rvb
SYMATTR Value xx
SYMBOL cap 240 80 R0
SYMATTR InstName Csnb
SYMATTR Value 1000p
SYMBOL res 384 176 R90
WINDOW 0 0 56 VBottom 2
WINDOW 3 32 56 VTop 2
SYMATTR InstName Rsnb
SYMATTR Value 22
SYMBOL res 1888 192 M0
SYMATTR InstName Rc2
SYMATTR Value 10k
SYMBOL res 1888 320 M0
SYMATTR InstName Rc1
SYMATTR Value 4.7k
SYMBOL pnp 1504 576 M180
SYMATTR InstName Q1
SYMATTR Value BC857B
SYMBOL res 1392 400 R0
SYMATTR InstName R1
SYMATTR Value xx
SYMBOL res 1392 576 R0
SYMATTR InstName R2
SYMATTR Value xx
SYMBOL res 1680 656 M270
WINDOW 0 32 56 VTop 2
WINDOW 3 0 56 VBottom 2
SYMATTR InstName R3
SYMATTR Value xx
SYMBOL zener 1744 736 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D1
SYMATTR Value 1N750
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL Math2r 1936 560 M0
SYMATTR InstName U4
SYMATTR SpiceModel +
SYMBOL zener 1424 784 R180
WINDOW 0 24 64 Left 2
WINDOW 3 24 0 Left 2
SYMATTR InstName D2
SYMATTR Value EDZV30B
SYMATTR Description Diode
SYMATTR Type diode
SYMBOL cap 1296 416 R0
SYMATTR InstName C1
SYMATTR Value xx
TEXT 1408 -320 Left 2 !.tran 0 100m 0 100n startup uic
TEXT 400 -8 Left 2 !K1 Lp Ls 0.999
TEXT 1408 -288 Left 2 !.ic V(vout)=0
TEXT 2208 -320 Left 2 !.lib filt.sub
TEXT 2208 -288 Left 2 !.lib mathfunc2.sub
TEXT 104 -424 Left 3 ;*********************************************************\nELECTENG 311 - Closed-Loop with Protection Model (Rev1.0)\nDuleepa J Thrimawithana\n08/06/2021\n*********************************************************
TEXT 1400 -432 Left 2 ;Simulation Commands\n- Change the simulation settings and initial conditions as needed\n- Library files filt.sub, mathfunc2.sub, PID.asy and Math2r.asy should be in the same folder
TEXT 88 856 Left 2 ;Notes\n- Change the R, L and C values along with Kp and Ki to what you calculated\n- Snubber components Rsnb and Csnb are use to help the simulation\n- PI controller is only an approximation of the digital PI controller you will use\n- Set Vref to 5V and Rload to 10k to check if over voltage protection limits the output to value you designed\n- Signal isolation employed in the recommended hardware setup is ignored for simplicity \n- Thus the operation of the protection circuit and PI controller is a crude approximation
